{% extends "base.html" %}

{% load widget_tweaks %}

{% block form %}
<div id="searchbar" class="d-flex flex-row">
    <form action="{% url 'search_result' %}" method=POST class="my-form input-group flex-nowrap bg-light mx-0 mx-lg-auto rounded p-1">
        {% csrf_token %}
        {{ place.place }}
        <input type="hidden" name="next" value="{{ request.path }}">
        {% render_field form.name placeholder="Search product..." class+="form-control input-form"%}
        {% comment %} <input type="text" id="search" placeholder="Search product" name="search-input" class="form-control rounded"> {% endcomment %}
        {% comment %} <button type="submit" class="btn btn-secondary"><i class="fa fa-search"></i></button> {% endcomment %}
    </form>
</div>
{% endblock %}

{% block extra_js %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        const form = document.querySelector('.my-form');
        const textField = document.querySelector('.input-form');
        let timer = null;
        function startTimer() {
            timer = setTimeout(() => {
                console.log("Searching...");
                form.submit();
            }, 1200);
        }
        function resetTimer() {
            if (timer) {
                clearTimeout(timer);
            }
        }
        textField.addEventListener('input', startTimer);
        textField.addEventListener('oninput', resetTimer);
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            form.submit();
        });
    </script>
{% endblock extra_js %}
